syntax = "proto3";

import "google/protobuf/empty.proto";

package msg;

option go_package = "github.com/caldog20/go-overlay/msg";


message RegisterRequest {
  string user = 1;
}

message RegisterReply {
  bool success = 1;
  string uuid = 2;
  string tunip = 3;
}

message ClientInfoRequest {
  string requester_id = 1;
  bool bulk = 2;
  string client_id = 3;
}

message ClientInfoReply {
  message Client {
    string uuid = 1;
    string user = 2;
    string tunip = 3;
    string remote = 4;
  }

  repeated Client clients = 1;
  uint64 client_count = 2;
}

message PunchSubscribe {
  string requestor_id = 1;
}

message PunchNotification {
  string puncher = 1;
}

message PunchRequest {
  string requestor_id = 1;
  string punchee_id = 2;
}


service ControlService {
  rpc Register(RegisterRequest) returns (RegisterReply) {}
  rpc ClientInfo(ClientInfoRequest) returns (ClientInfoReply) {}
  rpc Punch(PunchRequest) returns (google.protobuf.Empty) {}
  rpc PunchNotifier(PunchSubscribe) returns (stream PunchNotification) {}
}
